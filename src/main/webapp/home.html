<!-- <%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%> -->
<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Inventory Dashboard</title>

	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">

	<!-- Lucide Icons CDN -->
	<script src="https://unpkg.com/lucide@latest"></script>

	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: 'Inter', sans-serif;
			background-color: #f4f6fa;
			color: #333;
		}

		nav {
			background-color: #4e54c8;
			color: white;
			padding: 15px 30px;
			display: flex;
			justify-content: space-between;
			align-items: center;
			box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
		}

		.nav-left h1 {
			font-size: 24px;
			font-weight: 600;
		}

		.nav-right {
			display: flex;
			align-items: center;
			gap: 20px;
		}

		.nav-right input {
			padding: 8px 12px;
			border-radius: 6px;
			border: none;
			outline: none;
			font-size: 14px;
			width: 200px;
		}

		.nav-icon {
			display: flex;
			align-items: center;
			gap: 6px;
			background: white;
			color: #4e54c8;
			padding: 8px 12px;
			border-radius: 8px;
			cursor: pointer;
			font-weight: 500;
			transition: background 0.2s;
			text-decoration: none;
			/* remove underline from link */
		}

		.nav-icon:hover {
			background: #e1e4f0;
		}

		/* Ensures <a> inside nav-icon inherits styles properly */
		.nav-icon a {
			display: flex;
			align-items: center;
			gap: 6px;
			color: inherit;
			text-decoration: none;
		}

		.main-content {
			padding: 40px 30px;
			display: flex;
			justify-content: center;
			flex-wrap: wrap;
			gap: 30px;
		}

		/* .product-card {
			background-color: white;
			width: 280px;
			padding: 20px;
			border-radius: 16px;
			box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
			transition: transform 0.2s;
		} */

		/* .product-card:hover {
			transform: translateY(-4px);
		}

		.product-card h3 {
			margin-bottom: 10px;
			font-size: 20px;
		}

		.product-card p {
			color: #666;
			margin-bottom: 12px;
		}

		.product-card button {
			background-color: #4e54c8;
			color: white;
			padding: 10px 16px;
			border: none;
			border-radius: 8px;
			cursor: pointer;
			transition: background-color 0.2s;
		}

		.product-card button:hover {
			background-color: #3e42a1;
		} */

		.product-card {
			background-color: white;
			width: 300px;
			padding: 20px;
			border-radius: 20px;
			box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
			transition: transform 0.2s, box-shadow 0.3s;
			display: flex;
			flex-direction: column;
			justify-content: space-between;
		}

		.product-card:hover {
			transform: translateY(-5px);
			box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
		}

		.product-card h3 {
			font-size: 22px;
			margin-bottom: 8px;
			color: #333;
		}

		.vendor-tag {
			display: inline-block;
			background-color: #e8ebfb;
			color: #4e54c8;
			font-size: 13px;
			padding: 4px 8px;
			border-radius: 12px;
			margin-bottom: 10px;
			font-weight: 500;
		}

		.product-card p {
			font-size: 14px;
			color: #555;
			margin-bottom: 10px;
			line-height: 1.4;
		}

		.product-card .price {
			font-weight: bold;
			color: #2d2d2d;
			margin-bottom: 16px;
		}

		.product-card button {
			background-color: #4e54c8;
			color: white;
			padding: 10px 16px;
			border: none;
			border-radius: 10px;
			cursor: pointer;
			transition: background-color 0.2s;
			font-weight: 500;
			font-size: 14px;
		}

		.product-card button:hover {
			background-color: #3e42a1;
		}
	</style>
</head>

<body>

	<!-- Navigation Bar -->
	<nav>
		<div class="nav-left">
			<h1>Inventory</h1>
		</div>
		<div class="nav-right">
			<input type="text" placeholder="Search products..." />
			<div class="nav-icon">
				<a href="profile.html"> <i data-lucide="user"></i> <span>Profile</span>
				</a>
			</div>
			<div class="nav-icon">
				<a href="cart.html"> <i data-lucide="shopping-cart"></i> <span>Cart</span>
				</a>
			</div>
		</div>
	</nav>

	<!-- Main Content Area -->
	<div class="main-content" id="productList">
		<!-- Product will be dynamically inserted -->
	</div>

	<!-- Script -->
	<script>
		lucide.createIcons();

		// Function to load products (same as before)
		async function loadProducts() {
			try {
				const response = await fetch('http://localhost:3010/api/items');
				if (!response.ok) {
					throw new Error("Network response was not ok");
				}
				const products = await response.json();

				const container = document.getElementById("productList");
				container.innerHTML = ""; // Clear existing content

				products.forEach(p => {

					if (p.quantity > 0) {

						const div = document.createElement("div");
						div.className = "product-card";

						const title = document.createElement("h3");
						title.textContent = p.name;

						const vendorTag = document.createElement("div");
						vendorTag.className = "vendor-tag";
						vendorTag.textContent = p.vendorName;

						const desc = document.createElement("p");
						desc.textContent = p.description;

						const price = document.createElement("p");
						price.className = "price";
						price.textContent = "â‚¹" + p.price;

						const button = document.createElement("button");
						button.textContent = "Add to Cart";
						button.onclick = () => addToCart(p.id);

						div.append(title, vendorTag, desc, price, button);
						container.appendChild(div);
					}
				});

			} catch (error) {
				console.error("Failed to fetch products:", error);
				document.getElementById("productList").innerHTML = `<p style="color:red;">Unable to load products. Please try again later.</p>`;
			}
		}

		// Function to add a product to the cart and send it to the backend
		async function addToCart(itemId) {
			const customerId = localStorage.getItem("customerId"); // Assume login stores this
			if (!customerId) {
				alert("Please log in to add items to the cart.");
				return;
			}

			try {
				// Send a POST request to add the item to the backend cart
				const response = await fetch("http://localhost:3010/api/cart/add", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({
						customerId: parseInt(customerId),
						items: [{itemId: itemId, quantity: 1}] // Send one item at a time
					})
				});

				if (!response.ok) {
					const errorData = await response.json();
					throw new Error(errorData.message || "Failed to add item to cart");
				}

				alert("Item added to cart!");
			} catch (error) {
				console.error("Error during add to cart:", error);
				alert("Failed to add item to cart. Please try again later.");
			}
		}


		loadProducts();
	</script>

</body>

</html>